!function(){"use strict";var e=function(){this.init()};e.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var n=this||t;if(e=parseFloat(e),n.ctx||c(),void 0!==e&&e>=0&&e<=1){if(n._volume=e,n._muted)return n;n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var o=0;o<n._howls.length;o++)if(!n._howls[o]._webAudio)for(var r=n._howls[o]._getSoundIds(),a=0;a<r.length;a++){var i=n._howls[o]._soundById(r[a]);i&&i._node&&(i._node.volume=i._volume*e)}return n}return n._volume},mute:function(e){var n=this||t;n.ctx||c(),n._muted=e,n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e?0:n._volume,t.ctx.currentTime);for(var o=0;o<n._howls.length;o++)if(!n._howls[o]._webAudio)for(var r=n._howls[o]._getSoundIds(),a=0;a<r.length;a++){var i=n._howls[o]._soundById(r[a]);i&&i._node&&(i._node.muted=!!e||i._muted)}return n},stop:function(){for(var e=this||t,n=0;n<e._howls.length;n++)e._howls[n].stop();return e},unload:function(){for(var e=this||t,n=e._howls.length-1;n>=0;n--)e._howls[n].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,c()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,n=null;try{n="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!n||"function"!=typeof n.canPlayType)return e;var o=n.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator?e._navigator.userAgent:"",a=r.match(/OPR\/(\d+)/g),i=a&&parseInt(a[0].split("/")[1],10)<33,s=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),l=r.match(/Version\/(.*?) /),c=s&&l&&parseInt(l[1],10)<15;return e._codecs={mp3:!(i||!o&&!n.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!o,opus:!!n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(n.canPlayType('audio/wav; codecs="1"')||n.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!n.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!n.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/m4a;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(n.canPlayType("audio/x-m4b;")||n.canPlayType("audio/m4b;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(n.canPlayType("audio/x-mp4;")||n.canPlayType("audio/mp4;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(c||!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(c||!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!n.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(n.canPlayType("audio/x-flac;")||n.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var n=function(t){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var o=new Audio;o._unlocked=!0,e._releaseHtml5Audio(o)}catch(t){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var a=e._howls[r]._getSoundIds(),i=0;i<a.length;i++){var s=e._howls[r]._soundById(a[i]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0),document.removeEventListener("click",n,!0),document.removeEventListener("keydown",n,!0);for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("unlock")}};return document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("click",n,!0),document.addEventListener("keydown",n,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var n=(new Audio).play();return n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)&&n.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var n=this||t;return e._unlocked&&n._html5AudioPool.push(e),n},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&t.usingWebAudio){for(var n=0;n<e._howls.length;n++)if(e._howls[n]._webAudio)for(var o=0;o<e._howls[n]._sounds.length;o++)if(!e._howls[n]._sounds[o]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&t.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var t=new e,n=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};n.prototype={init:function(e){var n=this;return t.ctx||c(),n._autoplay=e.autoplay||!1,n._format="string"!=typeof e.format?e.format:[e.format],n._html5=e.html5||!1,n._muted=e.mute||!1,n._loop=e.loop||!1,n._pool=e.pool||5,n._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,n._rate=e.rate||1,n._sprite=e.sprite||{},n._src="string"!=typeof e.src?e.src:[e.src],n._volume=void 0!==e.volume?e.volume:1,n._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},n._duration=0,n._state="unloaded",n._sounds=[],n._endTimers={},n._queue=[],n._playLock=!1,n._onend=e.onend?[{fn:e.onend}]:[],n._onfade=e.onfade?[{fn:e.onfade}]:[],n._onload=e.onload?[{fn:e.onload}]:[],n._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],n._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],n._onpause=e.onpause?[{fn:e.onpause}]:[],n._onplay=e.onplay?[{fn:e.onplay}]:[],n._onstop=e.onstop?[{fn:e.onstop}]:[],n._onmute=e.onmute?[{fn:e.onmute}]:[],n._onvolume=e.onvolume?[{fn:e.onvolume}]:[],n._onrate=e.onrate?[{fn:e.onrate}]:[],n._onseek=e.onseek?[{fn:e.onseek}]:[],n._onunlock=e.onunlock?[{fn:e.onunlock}]:[],n._onresume=[],n._webAudio=t.usingWebAudio&&!n._html5,void 0!==t.ctx&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(n),n._autoplay&&n._queue.push({event:"play",action:function(){n.play()}}),n._preload&&"none"!==n._preload&&n.load(),n},load:function(){var e=this,n=null;if(!t.noAudio){"string"==typeof e._src&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var i,s;if(e._format&&e._format[r])i=e._format[r];else{if("string"!=typeof(s=e._src[r])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(i=/^data:audio\/([^;,]+);/i.exec(s))||(i=/\.([^.]+)$/.exec(s.split("?",1)[0])),i&&(i=i[1].toLowerCase())}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&t.codecs(i)){n=e._src[r];break}}return n?(e._src=n,e._state="loading","https:"===window.location.protocol&&"http:"===n.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new o(e),e._webAudio&&a(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")}e._emit("loaderror",null,"No audio support.")},play:function(e,n){var o=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===o._state&&!o._sprite[e])return null;if(void 0===e&&(e="__default",!o._playLock)){for(var a=0,i=0;i<o._sounds.length;i++)o._sounds[i]._paused&&!o._sounds[i]._ended&&(a++,r=o._sounds[i]._id);1===a?e=null:r=null}}var s=r?o._soundById(r):o._inactiveSound();if(!s)return null;if(r&&!e&&(e=s._sprite||"__default"),"loaded"!==o._state){s._sprite=e,s._ended=!1;var l=s._id;return o._queue.push({event:"play",action:function(){o.play(l)}}),l}if(r&&!s._paused)return n||o._loadQueue("play"),s._id;o._webAudio&&t._autoResume();var c=Math.max(0,s._seek>0?s._seek:o._sprite[e][0]/1e3),u=Math.max(0,(o._sprite[e][0]+o._sprite[e][1])/1e3-c),d=1e3*u/Math.abs(s._rate),h=o._sprite[e][0]/1e3,f=(o._sprite[e][0]+o._sprite[e][1])/1e3;s._sprite=e,s._ended=!1;var p=function(){s._paused=!1,s._seek=c,s._start=h,s._stop=f,s._loop=!(!s._loop&&!o._sprite[e][2])};if(!(c>=f)){var m=s._node;if(o._webAudio){var g=function(){o._playLock=!1,p(),o._refreshBuffer(s);var e=s._muted||o._muted?0:s._volume;m.gain.setValueAtTime(e,t.ctx.currentTime),s._playStart=t.ctx.currentTime,void 0===m.bufferSource.start?s._loop?m.bufferSource.noteGrainOn(0,c,86400):m.bufferSource.noteGrainOn(0,c,u):s._loop?m.bufferSource.start(0,c,86400):m.bufferSource.start(0,c,u),d!==1/0&&(o._endTimers[s._id]=setTimeout(o._ended.bind(o,s),d)),n||setTimeout((function(){o._emit("play",s._id),o._loadQueue()}),0)};"running"===t.state&&"interrupted"!==t.ctx.state?g():(o._playLock=!0,o.once("resume",g),o._clearTimer(s._id))}else{var _=function(){m.currentTime=c,m.muted=s._muted||o._muted||t._muted||m.muted,m.volume=s._volume*t.volume(),m.playbackRate=s._rate;try{var r=m.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(o._playLock=!0,p(),r.then((function(){o._playLock=!1,m._unlocked=!0,n?o._loadQueue():o._emit("play",s._id)})).catch((function(){o._playLock=!1,o._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0}))):n||(o._playLock=!1,p(),o._emit("play",s._id)),m.playbackRate=s._rate,m.paused)return void o._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||s._loop?o._endTimers[s._id]=setTimeout(o._ended.bind(o,s),d):(o._endTimers[s._id]=function(){o._ended(s),m.removeEventListener("ended",o._endTimers[s._id],!1)},m.addEventListener("ended",o._endTimers[s._id],!1))}catch(e){o._emit("playerror",s._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===m.src&&(m.src=o._src,m.load());var v=window&&window.ejecta||!m.readyState&&t._navigator.isCocoonJS;if(m.readyState>=3||v)_();else{o._playLock=!0,o._state="loading";var y=function(){o._state="loaded",_(),m.removeEventListener(t._canPlayEvent,y,!1)};m.addEventListener(t._canPlayEvent,y,!1),o._clearTimer(s._id)}}return s._id}o._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),o=0;o<n.length;o++){t._clearTimer(n[o]);var r=t._soundById(n[o]);if(r&&!r._paused&&(r._seek=t.seek(n[o]),r._rateSeek=0,r._paused=!0,t._stopFade(n[o]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var o=n._getSoundIds(e),r=0;r<o.length;r++){n._clearTimer(o[r]);var a=n._soundById(o[r]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,n._stopFade(o[r]),a._node&&(n._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),n._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause(),a._node.duration===1/0&&n._clearSound(a._node))),t||n._emit("stop",a._id))}return n},mute:function(e,n){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"mute",action:function(){o.mute(e,n)}}),o;if(void 0===n){if("boolean"!=typeof e)return o._muted;o._muted=e}for(var r=o._getSoundIds(n),a=0;a<r.length;a++){var i=o._soundById(r[a]);i&&(i._muted=e,i._interval&&o._stopFade(i._id),o._webAudio&&i._node?i._node.gain.setValueAtTime(e?0:i._volume,t.ctx.currentTime):i._node&&(i._node.muted=!!t._muted||e),o._emit("mute",i._id))}return o},volume:function(){var e,n,o,r=this,a=arguments;if(0===a.length)return r._volume;if(1===a.length||2===a.length&&void 0===a[1]?r._getSoundIds().indexOf(a[0])>=0?n=parseInt(a[0],10):e=parseFloat(a[0]):a.length>=2&&(e=parseFloat(a[0]),n=parseInt(a[1],10)),!(void 0!==e&&e>=0&&e<=1))return(o=n?r._soundById(n):r._sounds[0])?o._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,a)}}),r;void 0===n&&(r._volume=e),n=r._getSoundIds(n);for(var i=0;i<n.length;i++)(o=r._soundById(n[i]))&&(o._volume=e,a[2]||r._stopFade(n[i]),r._webAudio&&o._node&&!o._muted?o._node.gain.setValueAtTime(e,t.ctx.currentTime):o._node&&!o._muted&&(o._node.volume=e*t.volume()),r._emit("volume",o._id));return r},fade:function(e,n,o,r){var a=this;if("loaded"!==a._state||a._playLock)return a._queue.push({event:"fade",action:function(){a.fade(e,n,o,r)}}),a;e=Math.min(Math.max(0,parseFloat(e)),1),n=Math.min(Math.max(0,parseFloat(n)),1),o=parseFloat(o),a.volume(e,r);for(var i=a._getSoundIds(r),s=0;s<i.length;s++){var l=a._soundById(i[s]);if(l){if(r||a._stopFade(i[s]),a._webAudio&&!l._muted){var c=t.ctx.currentTime,u=c+o/1e3;l._volume=e,l._node.gain.setValueAtTime(e,c),l._node.gain.linearRampToValueAtTime(n,u)}a._startFadeInterval(l,e,n,o,i[s],void 0===r)}}return a},_startFadeInterval:function(e,t,n,o,r,a){var i=this,s=t,l=n-t,c=Math.abs(l/.01),u=Math.max(4,c>0?o/c:o),d=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var r=(Date.now()-d)/o;d=Date.now(),s+=l*r,s=Math.round(100*s)/100,s=l<0?Math.max(n,s):Math.min(n,s),i._webAudio?e._volume=s:i.volume(s,e._id,!0),a&&(i._volume=s),(n<t&&s<=n||n>t&&s>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,i.volume(n,e._id),i._emit("fade",e._id))}),u)},_stopFade:function(e){var n=this,o=n._soundById(e);return o&&o._interval&&(n._webAudio&&o._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(o._interval),o._interval=null,n.volume(o._fadeTo,e),o._fadeTo=null,n._emit("fade",e)),n},loop:function(){var e,t,n,o=this,r=arguments;if(0===r.length)return o._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(n=o._soundById(parseInt(r[0],10)))&&n._loop;e=r[0],o._loop=e}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var a=o._getSoundIds(t),i=0;i<a.length;i++)(n=o._soundById(a[i]))&&(n._loop=e,o._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,o.playing(a[i])&&(o.pause(a[i],!0),o.play(a[i],!0)))));return o},rate:function(){var e,n,o,r=this,a=arguments;if(0===a.length)n=r._sounds[0]._id;else if(1===a.length){r._getSoundIds().indexOf(a[0])>=0?n=parseInt(a[0],10):e=parseFloat(a[0])}else 2===a.length&&(e=parseFloat(a[0]),n=parseInt(a[1],10));if("number"!=typeof e)return(o=r._soundById(n))?o._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,a)}}),r;void 0===n&&(r._rate=e),n=r._getSoundIds(n);for(var i=0;i<n.length;i++)if(o=r._soundById(n[i])){r.playing(n[i])&&(o._rateSeek=r.seek(n[i]),o._playStart=r._webAudio?t.ctx.currentTime:o._playStart),o._rate=e,r._webAudio&&o._node&&o._node.bufferSource?o._node.bufferSource.playbackRate.setValueAtTime(e,t.ctx.currentTime):o._node&&(o._node.playbackRate=e);var s=r.seek(n[i]),l=1e3*((r._sprite[o._sprite][0]+r._sprite[o._sprite][1])/1e3-s)/Math.abs(o._rate);!r._endTimers[n[i]]&&o._paused||(r._clearTimer(n[i]),r._endTimers[n[i]]=setTimeout(r._ended.bind(r,o),l)),r._emit("rate",o._id)}return r},seek:function(){var e,n,o=this,r=arguments;if(0===r.length)o._sounds.length&&(n=o._sounds[0]._id);else if(1===r.length){o._getSoundIds().indexOf(r[0])>=0?n=parseInt(r[0],10):o._sounds.length&&(n=o._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),n=parseInt(r[1],10));if(void 0===n)return 0;if("number"==typeof e&&("loaded"!==o._state||o._playLock))return o._queue.push({event:"seek",action:function(){o.seek.apply(o,r)}}),o;var a=o._soundById(n);if(a){if(!("number"==typeof e&&e>=0)){if(o._webAudio){var i=o.playing(n)?t.ctx.currentTime-a._playStart:0,s=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(s+i*Math.abs(a._rate))}return a._node.currentTime}var l=o.playing(n);l&&o.pause(n,!0),a._seek=e,a._ended=!1,o._clearTimer(n),o._webAudio||!a._node||isNaN(a._node.duration)||(a._node.currentTime=e);var c=function(){l&&o.play(n,!0),o._emit("seek",n)};if(l&&!o._webAudio){var u=function(){o._playLock?setTimeout(u,0):c()};setTimeout(u,0)}else c()}return o},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var o=0;o<t._sounds.length;o++)if(!t._sounds[o]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,o=t._soundById(e);return o&&(n=t._sprite[o._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,n=e._sounds,o=0;o<n.length;o++)n[o]._paused||e.stop(n[o]._id),e._webAudio||(e._clearSound(n[o]._node),n[o]._node.removeEventListener("error",n[o]._errorFn,!1),n[o]._node.removeEventListener(t._canPlayEvent,n[o]._loadFn,!1),n[o]._node.removeEventListener("ended",n[o]._endFn,!1),t._releaseHtml5Audio(n[o]._node)),delete n[o]._node,e._clearTimer(n[o]._id);var a=t._howls.indexOf(e);a>=0&&t._howls.splice(a,1);var i=!0;for(o=0;o<t._howls.length;o++)if(t._howls[o]._src===e._src||e._src.indexOf(t._howls[o]._src)>=0){i=!1;break}return r&&i&&delete r[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,o){var r=this["_on"+e];return"function"==typeof t&&r.push(o?{id:n,fn:t,once:o}:{id:n,fn:t}),this},off:function(e,t,n){var o=this,r=o["_on"+e],a=0;if("number"==typeof t&&(n=t,t=null),t||n)for(a=0;a<r.length;a++){var i=n===r[a].id;if(t===r[a].fn&&i||!t&&i){r.splice(a,1);break}}else if(e)o["_on"+e]=[];else{var s=Object.keys(o);for(a=0;a<s.length;a++)0===s[a].indexOf("_on")&&Array.isArray(o[s[a]])&&(o[s[a]]=[])}return o},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var o=this,r=o["_on"+e],a=r.length-1;a>=0;a--)r[a].id&&r[a].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(o,r[a].fn),0),r[a].once&&o.off(e,r[a].fn,r[a].id));return o._loadQueue(e),o},_loadQueue:function(e){var t=this;if(t._queue.length>0){var n=t._queue[0];n.event===e&&(t._queue.shift(),t._loadQueue()),e||n.action()}return t},_ended:function(e){var n=this,o=e._sprite;if(!n._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(n._ended.bind(n,e),100),n;var r=!(!e._loop&&!n._sprite[o][2]);if(n._emit("end",e._id),!n._webAudio&&r&&n.stop(e._id,!0).play(e._id),n._webAudio&&r){n._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var a=1e3*(e._stop-e._start)/Math.abs(e._rate);n._endTimers[e._id]=setTimeout(n._ended.bind(n,e),a)}return n._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,n._clearTimer(e._id),n._cleanBuffer(e._node),t._autoSuspend()),n._webAudio||r||n.stop(e._id,!0),n},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var n=t._soundById(e);n&&n._node&&n._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new o(e)},_drain:function(){var e=this,t=e._pool,n=0,o=0;if(!(e._sounds.length<t)){for(o=0;o<e._sounds.length;o++)e._sounds[o]._ended&&n++;for(o=e._sounds.length-1;o>=0;o--){if(n<=t)return;e._sounds[o]._ended&&(e._webAudio&&e._sounds[o]._node&&e._sounds[o]._node.disconnect(0),e._sounds.splice(o,1),n--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=r[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),this},_cleanBuffer:function(e){var n=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!e.bufferSource)return this;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),n))try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var o=function(e){this._parent=e,this.init()};o.prototype={init:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,n._sounds.push(e),e.create(),e},create:function(){var e=this,n=e._parent,o=t._muted||e._muted||e._parent._muted?0:e._volume;return n._webAudio?(e._node=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(o,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=n._src,e._node.preload=!0===n._preload?"auto":n._preload,e._node.volume=o*t.volume(),e._node.load()),e},reset:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,n=e._parent;n._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(n._sprite).length&&(n._sprite={__default:[0,1e3*n._duration]}),"loaded"!==n._state&&(n._state="loaded",n._emit("load"),n._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var r={},a=function(e){var t=e._src;if(r[t])return e._duration=r[t].duration,void l(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),o=new Uint8Array(n.length),a=0;a<n.length;++a)o[a]=n.charCodeAt(a);s(o.buffer,e)}else{var c=new XMLHttpRequest;c.open(e._xhr.method,t,!0),c.withCredentials=e._xhr.withCredentials,c.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){c.setRequestHeader(t,e._xhr.headers[t])})),c.onload=function(){var t=(c.status+"")[0];"0"===t||"2"===t||"3"===t?s(c.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+c.status+".")},c.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete r[t],e.load())},i(c)}},i=function(e){try{e.send()}catch(t){e.onerror()}},s=function(e,n){var o=function(){n._emit("loaderror",null,"Decoding audio data failed.")},a=function(e){e&&n._sounds.length>0?(r[n._src]=e,l(n,e)):o()};"undefined"!=typeof Promise&&1===t.ctx.decodeAudioData.length?t.ctx.decodeAudioData(e).then(a).catch(o):t.ctx.decodeAudioData(e,a,o)},l=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},c=function(){if(t.usingWebAudio){try{"undefined"!=typeof AudioContext?t.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch(e){t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),n=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),o=n?parseInt(n[1],10):null;if(e&&o&&o<9){var r=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!r&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};"function"==typeof define&&define.amd&&define([],(function(){return{Howler:t,Howl:n}})),"undefined"!=typeof exports&&(exports.Howler=t,exports.Howl=n),"undefined"!=typeof global?(global.HowlerGlobal=e,global.Howler=t,global.Howl=n,global.Sound=o):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=o)}(),(()=>{var e,t;e=window,t={},function e(t,n,o,r){var a=!!(t.Worker&&t.Blob&&t.Promise&&t.OffscreenCanvas&&t.OffscreenCanvasRenderingContext2D&&t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype.transferControlToOffscreen&&t.URL&&t.URL.createObjectURL);function i(){}function s(e){var o=n.exports.Promise,r=void 0!==o?o:t.Promise;return"function"==typeof r?new r(e):(e(i,i),null)}var l,c,u,d,h,f,p,m,g,_=(u=Math.floor(1e3/60),d={},h=0,"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(l=function(e){var t=Math.random();return d[t]=requestAnimationFrame((function n(o){h===o||h+u-1<o?(h=o,delete d[t],e()):d[t]=requestAnimationFrame(n)})),t},c=function(e){d[e]&&cancelAnimationFrame(d[e])}):(l=function(e){return setTimeout(e,u)},c=function(e){return clearTimeout(e)}),{frame:l,cancel:c}),v=(m={},function(){if(f)return f;if(!o&&a){var t=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join("\n");try{f=new Worker(URL.createObjectURL(new Blob([t])))}catch(e){return void 0!==typeof console&&"function"==typeof console.warn&&console.warn("🎊 Could not load worker",e),null}!function(e){function t(t,n){e.postMessage({options:t||{},callback:n})}e.init=function(t){var n=t.transferControlToOffscreen();e.postMessage({canvas:n},[n])},e.fire=function(n,o,r){if(p)return t(n,null),p;var a=Math.random().toString(36).slice(2);return p=s((function(o){function i(t){t.data.callback===a&&(delete m[a],e.removeEventListener("message",i),p=null,r(),o())}e.addEventListener("message",i),t(n,a),m[a]=i.bind(null,{data:{callback:a}})}))},e.reset=function(){for(var t in e.postMessage({reset:!0}),m)m[t](),delete m[t]}}(f)}return f}),y={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function w(e,t,n){return function(e,t){return t?t(e):e}(e&&null!=e[t]?e[t]:y[t],n)}function b(e){return e<0?0:Math.floor(e)}function E(e){return parseInt(e,16)}function k(e){return e.map(A)}function A(e){var t=String(e).replace(/[^0-9a-f]/gi,"");return t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),{r:E(t.substring(0,2)),g:E(t.substring(2,4)),b:E(t.substring(4,6))}}function S(e){e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight}function C(e){var t=e.getBoundingClientRect();e.width=t.width,e.height=t.height}function T(e,t,n,a,i){var l,c,u=t.slice(),d=e.getContext("2d"),h=s((function(t){function s(){l=c=null,d.clearRect(0,0,a.width,a.height),i(),t()}l=_.frame((function t(){!o||a.width===r.width&&a.height===r.height||(a.width=e.width=r.width,a.height=e.height=r.height),a.width||a.height||(n(e),a.width=e.width,a.height=e.height),d.clearRect(0,0,a.width,a.height),u=u.filter((function(e){return function(e,t){t.x+=Math.cos(t.angle2D)*t.velocity+t.drift,t.y+=Math.sin(t.angle2D)*t.velocity+t.gravity,t.wobble+=t.wobbleSpeed,t.velocity*=t.decay,t.tiltAngle+=.1,t.tiltSin=Math.sin(t.tiltAngle),t.tiltCos=Math.cos(t.tiltAngle),t.random=Math.random()+2,t.wobbleX=t.x+10*t.scalar*Math.cos(t.wobble),t.wobbleY=t.y+10*t.scalar*Math.sin(t.wobble);var n=t.tick++/t.totalTicks,o=t.x+t.random*t.tiltCos,r=t.y+t.random*t.tiltSin,a=t.wobbleX+t.random*t.tiltCos,i=t.wobbleY+t.random*t.tiltSin;if(e.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+(1-n)+")",e.beginPath(),"circle"===t.shape)e.ellipse?e.ellipse(t.x,t.y,Math.abs(a-o)*t.ovalScalar,Math.abs(i-r)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI):function(e,t,n,o,r,a,i,s){e.save(),e.translate(t,n),e.rotate(a),e.scale(o,r),e.arc(0,0,1,0,s,void 0),e.restore()}(e,t.x,t.y,Math.abs(a-o)*t.ovalScalar,Math.abs(i-r)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI);else if("star"===t.shape)for(var s=Math.PI/2*3,l=4*t.scalar,c=8*t.scalar,u=t.x,d=t.y,h=5,f=Math.PI/h;h--;)u=t.x+Math.cos(s)*c,d=t.y+Math.sin(s)*c,e.lineTo(u,d),s+=f,u=t.x+Math.cos(s)*l,d=t.y+Math.sin(s)*l,e.lineTo(u,d),s+=f;else e.moveTo(Math.floor(t.x),Math.floor(t.y)),e.lineTo(Math.floor(t.wobbleX),Math.floor(r)),e.lineTo(Math.floor(a),Math.floor(i)),e.lineTo(Math.floor(o),Math.floor(t.wobbleY));return e.closePath(),e.fill(),t.tick<t.totalTicks}(d,e)})),u.length?l=_.frame(t):s()})),c=s}));return{addFettis:function(e){return u=u.concat(e),h},canvas:e,promise:h,reset:function(){l&&_.cancel(l),c&&c()}}}function L(e,n){var o,r=!e,i=!!w(n||{},"resize"),l=w(n,"disableForReducedMotion",Boolean),c=a&&w(n||{},"useWorker")?v():null,u=r?S:C,d=!(!e||!c||!e.__confetti_initialized),h="function"==typeof matchMedia&&matchMedia("(prefers-reduced-motion)").matches;function f(n){var a=l||w(n,"disableForReducedMotion",Boolean),f=w(n,"zIndex",Number);if(a&&h)return s((function(e){e()}));r&&o?e=o.canvas:r&&!e&&(e=function(e){var t=document.createElement("canvas");return t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=e,t}(f),document.body.appendChild(e)),i&&!d&&u(e);var p={width:e.width,height:e.height};function m(){if(c){var t={getBoundingClientRect:function(){if(!r)return e.getBoundingClientRect()}};return u(t),void c.postMessage({resize:{width:t.width,height:t.height}})}p.width=p.height=null}function g(){o=null,i&&t.removeEventListener("resize",m),r&&e&&(document.body.removeChild(e),e=null,d=!1)}return c&&!d&&c.init(e),d=!0,c&&(e.__confetti_initialized=!0),i&&t.addEventListener("resize",m,!1),c?c.fire(n,p,g):function(t,n,r){for(var a,i,s,l,c=w(t,"particleCount",b),d=w(t,"angle",Number),h=w(t,"spread",Number),f=w(t,"startVelocity",Number),p=w(t,"decay",Number),m=w(t,"gravity",Number),g=w(t,"drift",Number),_=w(t,"colors",k),v=w(t,"ticks",Number),y=w(t,"shapes"),E=w(t,"scalar"),A=function(e){var t=w(e,"origin",Object);return t.x=w(t,"x",Number),t.y=w(t,"y",Number),t}(t),S=c,C=[],L=e.width*A.x,I=e.height*A.y;S--;)C.push((i=(a={x:L,y:I,angle:d,spread:h,startVelocity:f,color:_[S%_.length],shape:y[(l=y.length,Math.floor(Math.random()*(l-0))+0)],ticks:v,decay:p,gravity:m,drift:g,scalar:E}).angle*(Math.PI/180),s=a.spread*(Math.PI/180),{x:a.x,y:a.y,wobble:10*Math.random(),wobbleSpeed:Math.min(.11,.1*Math.random()+.05),velocity:.5*a.startVelocity+Math.random()*a.startVelocity,angle2D:-i+(.5*s-Math.random()*s),tiltAngle:(.5*Math.random()+.25)*Math.PI,color:a.color,shape:a.shape,tick:0,totalTicks:a.ticks,decay:a.decay,drift:a.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:3*a.gravity,ovalScalar:.6,scalar:a.scalar}));return o?o.addFettis(C):(o=T(e,C,u,n,r)).promise}(n,p,g)}return f.reset=function(){c&&c.reset(),o&&o.reset()},f}function I(){return g||(g=L(null,{useWorker:!0,resize:!0})),g}n.exports=function(){return I().apply(this,arguments)},n.exports.reset=function(){I().reset()},n.exports.create=L}(function(){return void 0!==e?e:"undefined"!=typeof self?self:this||{}}(),t,!1),e.confetti=t.exports;const n={origin:{y:.7}};function o(e,t){confetti(Object.assign({},n,t,{particleCount:Math.floor(200*e)}))}function r(){o(.25,{spread:26,startVelocity:55}),o(.2,{spread:60}),o(.35,{spread:100,decay:.91,scalar:.8}),o(.1,{spread:120,startVelocity:25,decay:.92,scalar:1.2}),o(.1,{spread:120,startVelocity:45}),u("gameEnd")}const a=[{className:"theme--icy-sea",dark:"#7e98ad",light:"#c9d6d3"},{className:"theme--chess.com",dark:"#769656",light:"#eeeed2",highlight:"yellow"},{className:"theme--brown",dark:"#ae8a68",light:"#ecdab9",highlight:"yellow"},{className:"theme--pink",dark:"#d8a7b1",light:"#fbe3e8",highlight:"#ff7675"},{className:"theme--lichess-wood3",dark:"#604735",light:"#ecdab9",highlight:"yellow"},{className:"theme--lichess-blue3",dark:"#5a7488",light:"#c9d6d3"}],i=Math.random();let s=null;s=i<.5?a[4]:i<.75?a[3]:i<.85?a[0]:i<.95?a[2]:a[1];function l({className:e,dark:t,light:n,highlight:o}){const r=document.querySelector(".board");if(r){for(let e=0;e<r.classList.length;e++)r.classList[e].startsWith("theme--")&&r.classList.remove(r.classList[e]);r.classList.add(e),document.documentElement.style.setProperty("--color-dark",t),document.documentElement.style.setProperty("--color-light",n),o&&document.documentElement.style.setProperty("--color-yellow",o)}}2===(new Date).getMonth()+1&&(s=a[3]),l(s);const c={gameStart:new Howl({src:["./assets/game-start.mp3"]}),gameEnd:new Howl({src:["./assets/game-end.mp3"]}),move:new Howl({src:["./assets/move.mp3"]}),check:new Howl({src:["./assets/check.mp3"]}),capture:new Howl({src:["./assets/capture.mp3"]}),castle:new Howl({src:["./assets/castle.mp3"]}),promote:new Howl({src:["./assets/promote.mp3"]}),illegal:new Howl({src:["./assets/illegal.mp3"]})};function u(e){const t=c[e];t.currentTime=0,t.play()}Howler.volume(1);const d=(e=Math,t=16,n=n=>e.floor(n).toString(t),o=o=>" ".repeat(o).replace(/./g,(()=>n(e.random()*t))))=>o(8)+"-"+o(4)+"-"+o(4)+"-"+o(4)+"-"+o(12),h={k:"king",q:"queen",r:"rook",b:"bishop",n:"knight",p:"pawn"},f=new URLSearchParams(window.location.search);let p=f.get("pieces")||"ocean";const m=f.get("board")||localStorage.getItem("board"),g=localStorage.getItem("pieces");function _(e){e&&(e.includes("custom")?(document.querySelectorAll(".board").forEach((e=>{e.style.backgroundImage="",e.querySelectorAll(".square.light, .square.dark").forEach((e=>{e.style.backgroundColor=""}))})),e.includes("pink")?l(a[3]):e.includes("wood")?l(a[4]):e.includes("blue")?l(a[5]):e.includes("brown")?l(a[2]):e.includes("green")&&l(a[1])):(document.querySelectorAll(".board").forEach((t=>{t.style.backgroundImage=`url(https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/boards/${e}.png)`,t.querySelectorAll(".square.light, .square.dark").forEach((e=>{e.style.backgroundColor="transparent"}))})),["brown"].includes(e)?l(a[2]):["green"].includes(e)?l(a[1]):["icy_sea"].includes(e)?l(a[0]):["blue"].includes(e)?l(a[5]):["dark_wood"].includes(e)&&l(a[4])))}!f.get("pieces")&&g&&(p=g),localStorage.setItem("pieces",p),_(m);const v=".png",y={K:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/wk.png`,Q:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/wq.png`,R:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/wr.png`,B:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/wb.png`,N:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/wn.png`,P:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/wp.png`,k:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/bk.png`,q:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/bq.png`,r:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/br.png`,b:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/bb.png`,n:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/bn.png`,p:`https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces/${p}/bp.png`};"cburnett"===p&&Object.keys(y).forEach((e=>{y[e]=y[e].replace(v,".svg")}));if(/l-.*$/.test(p)){const e=/(\/.*?\/)(b|w)(k|q|r|b|n|p)\.(svg|png)$/i,t=t=>t.replace(e,((e,t,n,o,r)=>t+n+o.toUpperCase()+".svg"));Object.keys(y).forEach((e=>{y[e]=t(y[e]).replace("lightzane","lichess-org").replace("chess.com-boards-and-pieces","lila").replace("main/pieces","master/public/piece").replace(v,".svg").replace("l-","")}))}renderSettings(y,_,(function(e){j=e}));const w=function(){const e={};return e.onopen=()=>{setInterval(kt,8e3)},e.onclose=()=>{alert("Connection to server lost... reloading page."),window.location.reload()},e}();w.onmessage=({data:e})=>{!function(e){let t;try{t=JSON.parse(e)}catch(e){console.error(e)}if(!t)return;const{type:n,data:o}=t;switch(n){case"s.room.in":!function(e){if(E=e,E){document.getElementById("btnVsBot")?.remove(),document.getElementById("btnUndo")?.remove();const e=document.querySelector(".fen");e&&(e.style.display="none"),document.querySelectorAll(".score").forEach((e=>{e.style.display="flex"}))}St()?At(w,{type:"c.name.get",data:St()}):Ct()}(o);break;case"s.room.share-info":Tt(o);break;case"c.rid.register":!function(e){localStorage.setItem("rid",e);const t=()=>{let e=prompt("Name");return e||(e=t()),/^[a-zA-Z ]{2,}$/.test(e.trim())||(alert("Name must be alphabet and contains at least 2 characters"),e=t()),e};b=t(),At(w,{type:"c.name.set",data:{name:b,rid:St()}})}(o);case"c.name.get":!function(e){if(e)return void(b=e);Ct()}(o),function(){if(!E)return;At(w,{type:"c.room.join",data:St()})}();break;case"c.play.move":!function(e){const{from:t,to:n,timeWhite:o,timeBlack:r}=e;ke(t,n,!0),U.length>=C&&(wt.style.display="inline-block");o&&r&&(k.timeWhite=o,k.timeBlack=r,Rt())}(o);break;case"c.play.checkmate":!function({scores:e,aPgnArchive:t}){k.status="finished",k.scores=e,k.pgnArchive.unshift(t),Bt(e),mt.style.display="block",wt.style.display="none",Rt()}(o);break;case"c.rematch.request":!function(e){const t=confirm(`${e} wants to rematch. Do you ACCEPT?`);mt.style.display="none",!1===t&&(k.status="closed");At(w,{type:"c.rematch.response",data:t})}(o);break;case"c.rematch.response":!function(e){if(!e||!1===e)return void alert("Rematch Declined");pe(),de(),Se(),Tt(e),u("gameStart")}(o);break;case"c.resign":!function({message:e,scores:t,aPgnArchive:n}){Pt(n),F=!1,k.status="finished",k.scores=t,k.pgnArchive.unshift(n),Bt(t),wt.style.display="none",yt.style.display="none",u("gameEnd"),clearInterval(T),setTimeout((()=>{alert(e),mt.style.display="block"}),1e3)}(o);break;case"c.time.set":It(o);break;case"s.time.info":!function({timeWhite:e,timeBlack:t}){k.timeWhite=e,k.timeBlack=t,Rt()}(o);break;case"c.time.out":!function({timeWhite:e,timeBlack:t,aPgnArchive:n,message:o,scores:a}){F=!1,k.status="finished",k.timeWhite=e,k.timeBlack=t,k.scores=a,k.pgnArchive.unshift(n),Bt(a),Rt(),r(),u("gameEnd"),setTimeout((()=>{mt.style.display="block",wt.style.display="none",yt.style.display="none",alert(o),L&&L.release()}),500)}(o);break;case"c.draw.offer":confirm(`${o} offers a draw. Do you accept?`)?Mt():At(w,{type:"c.draw.declined",data:!0});break;case"c.draw.declined":!function(e){alert(`${e} does not want to draw.`)}(o);break;case"c.draw.accepted":!function({timeWhite:e,timeBlack:t,aPgnArchive:n,message:o,scores:a}){F=!1,k.status="finished",k.timeWhite=e,k.timeBlack=t,k.scores=a,k.pgnArchive.unshift(n),Bt(a),Rt(),r(),u("gameEnd"),setTimeout((()=>{mt.style.display="block",wt.style.display="none",yt.style.display="none",alert(o),L&&L.release()}),500)}(o);break;case"s.error":!function(e){console.error(e),alert(e),"object"==typeof e&&alert(JSON.stringify(e))}(o)}}(e)};let b=null,E=!1,k=null,A=null,S=null;const C=20;let T=null,L=null,I="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",x=I.split(" "),B=x[0],M=!x[1]||"w"===x[1],P="e1",R="e8",q=[],$=[],D=[],N=null,O=null,H=null,F=!0,U=[],G=null,z=[],V="black",W=!1;const Q=25;let j=localStorage.getItem("search-time")??1;isNaN(j)?j=1:+j>9?j=9:+j<-1&&(j=-1),localStorage.setItem("search-time",j);let X=null,K=[],Y=[],Z=!1,J=null;const ee=["g1","g8","c1","c8"],te="hl-hov-square",ne="hl-previous-move",oe="hl-square",re="hl-legal-squares",ae="hl-capture";let ie=!1,se=!1;function le(){document.querySelector(".board").removeEventListener("pointerleave",Ee);const e=document.getElementsByClassName("square");for(let t=0;t<e.length;t++)e[t].removeEventListener("pointermove",me),e[t].removeEventListener("pointerout",ge),e[t].removeEventListener("pointerup",_e)}function ce(){const e=document.getElementsByClassName("square");for(let t=se?63:0;se?t>=0:t<e.length;se?t--:t++){const n=se?1+Math.floor(t/8):8-Math.floor(t/8),o=se?String.fromCharCode(104-t%8):String.fromCharCode(97+t%8);e[t].id=o+n}}function ue(){const e=document.getElementsByClassName("square"),t=e=>e.remove();document.querySelectorAll(".file").forEach(t),document.querySelectorAll(".rank").forEach(t);for(let t=se?63:0;se?t>=0:t<e.length;se?t--:t++){const n=se?1+Math.floor(t/8):8-Math.floor(t/8),o=se?String.fromCharCode(104-t%8):String.fromCharCode(97+t%8),r=e[t];if(t>=56&&t<=64){const e=document.createElement("div");e.classList.add("file"),r.prepend(e),e.textContent=o}if((t+1)%8==1){const e=document.createElement("div");e.classList.add("rank"),r.prepend(e),e.textContent=n}}}function de(){$=[],U=[],D=[],q=[],N=null,G=null,V="black",z=[],K=[],Y=[],Z=!1,O=null,H=null,F=!0,P="e1",R="e8"}function he(){const e=document.getElementsByClassName("square"),t=function(e){return e.replace(/\d/g,(e=>"1".repeat(+e)))}(B).split("/");for(let o=se?63:0;se?o>=0:o<e.length;se?o--:o++){const r=se?1+Math.floor(o/8):8-Math.floor(o/8),a=se?String.fromCharCode(104-o%8):String.fromCharCode(97+o%8),i=97-a.charCodeAt(0),s=e[o];s.id=a+r;let l="",c="",u="";const f=t[8-r].charAt(-i);if(isNaN(+f)?(l=(n=f)===n.toUpperCase()?"white":"black",c=h[f.toLowerCase()],u=$.length===e.length?Ie(s.id).pieceId:d(),"king"===c&&("white"===l&&(P=s.id),"black"===l&&(R=s.id))):(l=null,c=null,u=null),$.length<e.length&&$.push({squareId:s.id,color:l,pieceType:c,pieceId:u}),s.querySelectorAll(".piece").forEach((e=>{e.remove()})),u){const e=document.createElement("div");e.id=u,e.dataset.color=l,e.classList.add("piece"),e.classList.add(c),e.addEventListener("pointerdown",ye),e.addEventListener("pointermove",we);const t=document.createElement("img");t.src=y[f],t.alt=f,t.setAttribute("draggable",!1),e.appendChild(t),s.appendChild(e)}}var n;const o=ut(),r=document.querySelector(".fen");r&&(r.textContent=o),U.length||u("gameStart")}function fe(e,t="💢"){const{color:n}=Ie(e),o=document.getElementById(e);if(!e)throw new Error(`[CHESS_ERROR] Unable to insert checkmate emblem in squareId: ${e}`);const r=document.createElement("div"),a=document.createElement("div"),i=.45*o.getBoundingClientRect().height;r.classList.add("checkmate-container"),a.textContent=t,a.classList.add("checkmate"),a.classList.add(n),a.style.height=i+"%",a.style.width=i+"%",r.append(a),o.append(r)}function pe(e=null){const t=document.getElementById(e);if(e&&t){const e=t.querySelector(".checkmate-container");if(!e)return;e.remove()}else document.querySelectorAll(".checkmate-container").forEach((e=>{e.remove()}));document.querySelectorAll(".bloody-check").forEach((e=>e.remove()))}function me(e){if(!F||!O)return;be(e),e.preventDefault();const t=e.target;2===t.id.length?t.classList.add(te):t.parentElement.classList.add(te)}function ge(e){F&&(e.preventDefault(),e.target.classList.remove(te))}function _e(e){e.preventDefault(),le();const t=e.currentTarget.id;if(O&&N===t&&q.length)return H=O,O.classList.remove("dragging"),document.getElementById(N).appendChild(O),function(e){const t=document.getElementById(e);t.querySelectorAll(`.${oe}`).forEach((e=>e.remove()));const n=document.createElement("div");n.classList.add(oe),t.append(n)}(N),void(O=null);Te();O&&(O.classList.remove("dragging"),O=null,H=null,Ce(),ke(N,t))}function ve(e){if(e.preventDefault(),!xt())return;if(2===e.button)return;if(!H)return;document.querySelectorAll(`.${oe}`).forEach((e=>e.remove()));const t=e.currentTarget.id;N!==t&&(document.querySelectorAll(".square").forEach((e=>{e.removeEventListener("pointerdown",ve)})),le(),Te(),Ce(),H=null,q.includes(t)&&(ke(N,t),Ae(N,t)))}function ye(e){if(!F)return;if(2===e.button)return;if(!xt())return;const t=e.target;ce(),function(){document.querySelector(".board").addEventListener("pointerleave",Ee);const e=document.getElementsByClassName("square");for(let t=0;t<e.length;t++)e[t].addEventListener("pointermove",me),e[t].addEventListener("pointerout",ge),e[t].addEventListener("pointerup",_e),e[t].addEventListener("pointerdown",ve)}();const n=t.parentElement.id,{color:o,pieceType:r}=Ie(n);if(H){const e=H.parentElement.id,{color:n}=Ie(e);if(o!==n&&H.id!==t.id)return}N=n;if(M&&"white"===o||!M&&"black"===o){if(Ce(),Te(),O=t,be(e),q=[...Me(n)],q=nt(q,n,o,r),q=[...new Set(q)],"king"===r){const e=Ye(n,o),t="white"===o?1:8,r=ot(o),a=rt(o);let i=!1,s=!1;r&&(i=Ye(`f${t}`,o)),a&&(s=Ye(`d${t}`,o)),e&&(r||a)?q=q.filter((e=>!ee.includes(e))):(i&&(q=q.filter((e=>e!==`g${t}`))),s&&(q=q.filter((e=>e!==`c${t}`))))}q.forEach((e=>{const{color:t}=Ie(e),n=document.getElementById(e),r=document.createElement("div");r.classList.add(re),n.appendChild(r),t&&t!==o&&r.classList.add(ae)}))}}function we(e){if(O){const e=O;e.classList.add("dragging"),document.body.append(e)}}function be(e){if(!O)return;const t=O;let n=t.getBoundingClientRect().width,o=t.getBoundingClientRect().height;n=e.clientX-n/2,o=e.clientY-o/2,("ontouchstart"in window||navigator.maxTouchPoints>0)&&(o-=50),t.style.left=`${n}px`,t.style.top=`${o}px`}function Ee(e){le(),document.getElementById(N).append(O),O.classList.remove("dragging"),O=null,document.querySelectorAll(`.${re}`).forEach((e=>e.remove())),document.querySelectorAll(`.${te}`).forEach((e=>e.classList.remove(te)))}function ke(e,t,n=!1){let o=null;n&&3===t.length&&(o=t.slice(2,3),t=t.slice(0,2));const r=e,a=t,i=document.getElementById(a),{pieceId:s,pieceType:l,color:c}=Ie(r),{color:d}=Ie(a),f=document.getElementById(s);n&&q.push(t);const p=r===a,m=!q.includes(a);if(p||m)return document.getElementById(r).appendChild(f),q=[],void(r!==a&&u("illegal"));let g;if("king"===l){if(Ye(a,c))return;ee.includes(a)&&!at(c)&&(!function(e,t){const n="white"===e?1:8;let o=null,r=null;t===`g${n}`&&(o=`h${n}`,r=`f${n}`);t===`c${n}`&&(o=`a${n}`,r=`d${n}`);const{pieceId:a}=Ie(o),i=document.getElementById(a);document.getElementById(r).append(i),xe($,o,r),Ae(o,r)}(c,a),g=!0),"white"===c?P=a:R=a}let _,v=!1;if(d){if(d===c)return;{const e=i.querySelector(".piece");e.removeEventListener("pointerdown",ye),e.removeEventListener("pointermove",we),i.removeChild(e),v=!0}}if(G===a&&(!function(e){if(!G)return;const t="white"===e?-1:1,n=+G[1]+t,o=Ie(`${G[0]}${n}`);let r=document.getElementById(o.squareId).querySelector(".piece");r&&(r.remove(),r.removeEventListener("pointerdown",ye),r.removeEventListener("pointermove",we));r=document.getElementById(o.pieceId),r&&(r.remove(),r.removeEventListener("pointerdown",ye),r.removeEventListener("pointermove",we));o.color=null,o.pieceId=null,o.pieceType=null}(c),v=!0),!f)throw new Error(`[CHESS_ERROR] Unable to move piece with id (${s}) positioned at squareId: ${r}`);if(i.appendChild(f),n&&Ae(r,a),xe($,r,a),q=[],G=null,"pawn"===l){const e="white"===c?2:7,t="white"===c?2:-2,n="white"===c?3:6;+r[1]===e&&+a[1]===e+t&&(G=`${a[0]}${n}`)}if("pawn"===l){const e="white"===c&&8==+a[1],t="black"===c&&1==+a[1];(e||t)&&(_="pending")}if(U.push({from:r,to:a,color:c,pieceType:l,hasCapture:v,castle:g,promotion:_}),Y.push(e+t),Et(),u(g?"castle":v?"capture":"move"),Le(r,a),_)return n?(st(o),void setTimeout((()=>{lt(c,h[o],a),ct(n)}),250)):(F=!1,void function(e){if(e.length>2)throw new Error("[CHESS_ERROR] Invalid square id. Unable to promote.");const{color:t}=Ie(e),n="white"===t?8:1;if(8!==n&&1!==n)return!1;if("white"===t&&+e[1]!==n)throw new Error(`[CHESS_ERROR] Unable to promote white with squareId: ${e}`);if("black"===t&&+e[1]!==n)throw new Error(`[CHESS_ERROR] Unable to promote black with squareId: ${e}`);const o=document.createElement("div"),r=document.createElement("div");o.classList.add("promotion-container"),r.classList.add("promotion-content"),o.append(r);let a=["Q","R","B","N"];"black"===t&&(a=a.map((e=>e.toLowerCase())));const i=document.getElementById(e);if(!i)throw new Error("[CHESS_ERROR] Board square was not found");const s=.95*i.getBoundingClientRect().height;a.forEach(((n,a)=>{const i=document.createElement("div"),l=document.createElement("img");l.src=y[n],l.alt=n,l.height=s,l.width=s,i.addEventListener("click",(()=>{lt(t,h[n.toLowerCase()],e),o.remove(),st(n),F=!0;const{from:r,to:a}=U[U.length-1];Lt(r,a),ct()})),i.classList.add("promotion-square"),i.append(l),r.append(i),1===a&&r.append(document.createElement("br"))}));const l=document.querySelector(".board");if(!l)throw new Error("[CHESS_ERROR] Board was not found");l.append(o)}(a));E&&xt()&&!n&&!_&&Lt(r,a),ct(n)}function Ae(e,t){const n=document.getElementById(t),o=document.getElementById(e);if(!n||!o)return;const r=n.querySelector(".piece");if(!r)return;let a=o.getBoundingClientRect().top,i=o.getBoundingClientRect().left;const s=o.getBoundingClientRect().width,l=n.getBoundingClientRect().top,c=n.getBoundingClientRect().left,u=r.style.transition,d=r.style.position,h=r.style.zIndex;r.style.position="fixed",r.style.zIndex="1000",r.style.top=a+"px",r.style.left=i+"px",r.style.height=s+"px",r.style.width=s+"px";let f=c-i,p=l-a;r.style.transition="transform 250ms ease-in-out",r.style.transform=`translate(${f}px, ${p}px)`,setTimeout((()=>{r.style.transition=u,r.style.transform="translate(0,0)",r.style.position=d,r.style.zIndex=h,r.style.top="auto",r.style.left="auto"}),250)}function Se(){document.querySelectorAll(`.${ne}`).forEach((e=>{e.remove()}))}function Ce(){const e=document.getElementsByClassName(re);for(;e.length>0;)e[0].remove()}function Te(){document.querySelectorAll(`.${te}`).forEach((e=>e.classList.remove(te)))}function Le(e,t){Se();const n=document.getElementById(e),o=document.getElementById(t),r=document.createElement("div"),a=document.createElement("div");r.classList.add(ne),a.classList.add(ne),n.appendChild(r),o.appendChild(a)}function Ie(e,t=$){const n=t.find((t=>t.squareId===e));if(!n)throw new Error(`[CHESS_ERROR] Square with squareId "${e}" was not found`);return n}function xe(e,t,n){const o=e.findIndex((e=>e.squareId===t)),r=e.findIndex((e=>e.squareId===n)),a=e[o];e[r]={...a,squareId:n},a.color=null,a.pieceId=null,a.pieceType=null}function Be(e){return[e.charAt(0),+e.charAt(1)]}function Me(e,t=$){const{pieceId:n,color:o,pieceType:r}=Ie(e);if(!n)throw new Error(`[CHESS_ERROR] No piece identified at squareId: ${e}`);switch(r){case"pawn":return function(e,t,n=$){return[...Re(e,t,n),...qe(e,t,n)]}(e,o,t);case"knight":return $e(e,o,t);case"rook":return De(e,o,t);case"bishop":return Ne(e,o,t);case"queen":return Oe(e,o,t);case"king":return He(e,o,t);default:throw new Error("[CHESS_ERROR] Unknown piece type")}}function Pe(e,t){return e.filter((e=>e.color===t)).flatMap((({squareId:t,color:n,pieceType:o})=>nt(Me(t,tt(e)),t,n,o)))}function Re(e,t,n=$){const[o,r]=Be(e),a=[];let i=o,s=r,l=e;if(s+="white"===t?1:-1,s>8||s<1)return a;const c=[-1,1];for(const e of c)if(i=String.fromCharCode(o.toLowerCase().charCodeAt(0)+e),i>="a"&&i<="h"){l=`${i}${s}`;const{color:e}=Ie(l,n);e&&e!==t&&a.push(l),e||l!==G||a.push(l)}return a}function qe(e,t,n=$){const[o,r]=Be(e),a=[];let i=o,s=r;s+="white"===t?1:-1;let l=`${i}${s}`,c=Ie(l,n);return c.pieceId?a:(a.push(l),"white"===t&&2===r&&s++,"black"===t&&7===r&&s--,l=`${i}${s}`,c=Ie(l,n),c.pieceId||a.push(l),a)}function $e(e,t,n=$){return[...Ke(e,t,[[-1,2],[1,2],[-2,1],[2,1],[-2,-1],[2,-1],[-1,-2],[1,-2]],n)]}function De(e,t,n=$){const o=Be(e);return[...Ue(o,t,n),...Ge(o,t,n),...ze(o,t,n),...Ve(o,t,n)]}function Ne(e,t,n=$){const o=Be(e);return[...We(o,t,n),...Qe(o,t,n),...je(o,t,n),...Xe(o,t,n)]}function Oe(e,t,n=$){const o=Be(e);return[...Ue(o,t,n),...Ge(o,t,n),...ze(o,t,n),...Ve(o,t,n),...We(o,t,n),...Qe(o,t,n),...je(o,t,n),...Xe(o,t,n)]}function He(e,t,n=$){const o="white"===t?1:8,r=[];return ot(t,n)&&r.push(`g${o}`),rt(t,n)&&r.push(`c${o}`),[...Ke(e,t,[[-1,1],[0,1],[1,1],[-1,-1],[0,-1],[1,-1],[-1,0],[1,0]],n),...r]}function Fe({file:e,rank:t,color:n,legalSquares:o},r=$){const a=e+t,{color:i}=Ie(a,r);return(!i||i!==n)&&(o.push(a),!i||i===n)}function Ue(e,t,n=$){const o=e[0];let r=e[1];const a=[];for(;r<8;){r++;if(!Fe({file:o,rank:r,color:t,legalSquares:a},n))break}return a}function Ge(e,t,n=$){const o=e[0];let r=e[1];const a=[];for(;r>1;){r--;if(!Fe({file:o,rank:r,color:t,legalSquares:a},n))break}return a}function ze(e,t,n=$){let o=e[0];const r=e[1],a=[];for(;o<"h";){const e=o.charCodeAt(0)+1;o=String.fromCharCode(e);if(!Fe({file:o,rank:r,color:t,legalSquares:a},n))break}return a}function Ve(e,t,n=$){let o=e[0];const r=e[1],a=[];for(;o>"a";){const e=o.charCodeAt(0)-1;o=String.fromCharCode(e);if(!Fe({file:o,rank:r,color:t,legalSquares:a},n))break}return a}function We(e,t,n=$){let[o,r]=e;const a=[];for(;o<"h"&&r<8;){const e=o.charCodeAt(0)+1;o=String.fromCharCode(e),r++;if(!Fe({file:o,rank:r,color:t,legalSquares:a},n))break}return a}function Qe(e,t,n=$){let[o,r]=e;const a=[];for(;o>"a"&&r>1;){const e=o.charCodeAt(0)-1;o=String.fromCharCode(e),r--;if(!Fe({file:o,rank:r,color:t,legalSquares:a},n))break}return a}function je(e,t,n=$){let[o,r]=e;const a=[];for(;o>"a"&&r<8;){const e=o.charCodeAt(0)-1;o=String.fromCharCode(e),r++;if(!Fe({file:o,rank:r,color:t,legalSquares:a},n))break}return a}function Xe(e,t,n=$){let[o,r]=e;const a=[];for(;o<"h"&&r>1;){const e=o.charCodeAt(0)+1;o=String.fromCharCode(e),r--;if(!Fe({file:o,rank:r,color:t,legalSquares:a},n))break}return a}function Ke(e,t,n,o=$){const[r,a]=Be(e),i=[];let s=r,l=a;return n.forEach((([e,n])=>{s=String.fromCharCode(r.charCodeAt(0)+e),l=a+n;if(s<"a"||s>"h"||l>8||l<1)return;const c=s+l,{color:u}=Ie(c,o);t!==u&&i.push(c)})),i}function Ye(e,t,n=$){for(const o of De(e,t,n)){const{pieceType:e,color:r}=Ie(o,n);switch(e){case"rook":case"queen":if(t!==r)return!0}}for(const o of Ne(e,t,n)){const{pieceType:e,color:r}=Ie(o,n);switch(e){case"bishop":case"queen":if(t!==r)return!0}}for(const o of $e(e,t,n)){const{pieceType:e,color:r}=Ie(o,n);if("knight"===e)if(t!==r)return!0}for(const o of He(e,t,n)){const{pieceType:e,color:r}=Ie(o,n);if("king"===e)if(t!==r)return!0}for(const o of Re(e,t,n)){const{pieceType:e,color:r}=Ie(o,n);if("pawn"===e)if(t!==r)return!0}return!1}function Ze(){const e=M?P:R,t=M?R:P,n=M?"white":"black",o=tt($);if(!Ye(e,n,o))return!1;if(Pe(o,n).length>0)return!1;if(pe(),et(e,!0),fe(e),fe(t,"💎"),F=!1,E&&k){const e=M?k.black.rid:k.white.rid;At(w,{type:"c.play.checkmate",data:e}),k.status="finished",Rt()}return r(),!0}function Je(e,t){const n=["😱","😨","🥵","😡","😤"].filter((e=>e!==J)),o=Math.floor(Math.random()*n.length),r=t??n[o];pe(e),fe(e,r),J=r}function et(e,t=!1){const n=document.getElementById(e);if(n)if(n.querySelectorAll(".bloody-check").forEach((e=>e.remove())),t){const e=n.querySelector(".piece");e&&e.classList.add("bloody-checkmate")}else{const e=document.createElement("div");n.prepend(e),e.classList.add("bloody-check")}}function tt(e){return e.map((e=>({...e})))}function nt(e,t,n,o){const r=M?P:R,a=tt($);return[...e].forEach((i=>{const s=tt(a);xe(s,t,i),"king"!==o&&Ye(r,n,s)&&(e=e.filter((e=>e!==i))),"king"===o&&Ye(i,n,s)&&(e=e.filter((e=>e!==i)))})),e}function ot(e,t=$){const n="white"===e?1:8,o=t.find((e=>e.squareId===`f${n}`&&e.pieceId)),r=t.find((e=>e.squareId===`g${n}`&&e.pieceId));return!(o||r||at(e)||it(e,`h${n}`,t))}function rt(e,t=$){const n="white"===e?1:8,o=t.find((e=>e.squareId===`b${n}`&&e.pieceId)),r=t.find((e=>e.squareId===`c${n}`&&e.pieceId)),a=t.find((e=>e.squareId===`d${n}`&&e.pieceId));return!(o||r||a||at(e)||it(e,`a${n}`,t))}function at(e){return!!U.find((t=>t.color===e&&"king"===t.pieceType))}function it(e,t,n=$){const o=n.find((n=>n.squareId===t&&n.color===e&&"rook"===n.pieceType)),r=U.find((n=>n.color===e&&n.from===t&&"rook"===n.pieceType));return!o||r}function st(e){const t=U.find((e=>"pending"===e.promotion));if(!t)throw new Error("[CHESS_ERROR] Unable to find promotion move state");t.promotion=e.toUpperCase(),Et(),u("promote")}function lt(e,t,n){const o=document.getElementById(n);if(!o)throw new Error(`[CHESS_ERROR] Unable to create piece at ${n}`);const r=o.querySelector(".piece");r&&(r.removeEventListener("pointerdown",ye),r.removeEventListener("pointermove",we),r.remove());const a=d(),i=document.createElement("div");i.classList.add("piece"),i.classList.add(t.toLowerCase()),i.dataset.color=e,i.id=a,i.addEventListener("pointerdown",ye),i.addEventListener("pointermove",we);let s=t[0].toLowerCase();"knight"===t&&(s="n");const l=document.createElement("img");l.alt=s,s="white"===e?s.toUpperCase():s.toLowerCase(),l.src=y[s],i.append(l),o.append(i);const c=Ie(n);c.pieceId=a,c.pieceType=t,c.color=e}function ct(e=!1){!function(e=500){setTimeout((()=>{ie&&ht()}),e)}(),pe(),M=!M,K.push(function({color:e,castle:t,from:n,to:o,pieceType:r,hasCapture:a,promotion:i},s){const l=o[0];let c="";t&&("g"===l&&(c="O-O"),"c"===l&&(c="O-O-O"));const d=()=>{if("king"===r)return;const t=$.filter((t=>t.color===e&&t.pieceType===r&&t.squareId!==n));for(let a=0;a<t.length;a++){const i=t[a].squareId;let s=[];const l="white"===e?"black":"white";if("knight"===r?s=$e(i,l):"bishop"===r?s=Ne(i,l):"rook"===r?s=De(i,l):"queen"===r&&(s=Oe(i,l)),s.includes(o)){const e=n.charAt(0)===i.charAt(0);c+=e?n.charAt(1):n.charAt(0);break}}};if("pawn"===r)c+="";else{let e=r.charAt(0).toUpperCase();"knight"===r&&(e="N"),t||(c+=e),d()}a&&("pawn"===r&&(c+=n.charAt(0)),c+="x");t||(c+=o);i&&(c+="="+i);const h="white"===e?"black":"white";let f="white"===h?P:R;Ze()?s>=0&&s===U.length&&(c+="#"):Ye(f,h)&&(c+="+",s===U.length&&(u("check"),Je(f),et(f)));return _t(s,c,e),c}(U[U.length-1],U.length));const t="white"===V&&M,n="black"===V&&!M,o=ut();D.push(o),x=o.split(" "),B=x[0],E&&!e&&At(w,{type:"c.state.fenpgn",data:[o,K[K.length-1]]});const r=document.querySelector(".fen");r&&(r.textContent=o);let a=!1,i=!1,s=!1,l=!1;(function(){const e=e=>e.split(" ").slice(0,4).join(" ");return D.some((t=>{const n=e(t);return D.filter((t=>e(t)===n)).length>=3}))})()&&(fe(P,"🤝"),fe(R,"🤝"),s=!0),function(e=D[D.length-1]){const t=e.split(" ")[0],n=t.split("").filter((e=>"B"===e)).length,o=t.split("").filter((e=>"b"===e)).length,r=t.split("").filter((e=>"N"===e)).length,a=t.split("").filter((e=>"n"===e)).length,i=t.split("").filter((e=>"Q"===e)).length,s=t.split("").filter((e=>"q"===e)).length,l=t.split("").filter((e=>"R"===e)).length,c=t.split("").filter((e=>"r"===e)).length,u=t.split("").filter((e=>"P"===e)).length,d=t.split("").filter((e=>"p"===e)).length;if(i+s+l+c+u+d>0)return!1;if(r+a>1)return!1;if(n+o>1)return!1;if((n>0||o>0)&&r+a>0)return!1;return!0}()&&(pe(),fe(P,"🤝"),fe(R,"🤝"),F=!1,a=!0,l=!0);const c=Ze(),d=function(){const e=M?P:R,t=M?R:P,n=M?"white":"black",o=tt($);return!Ye(e,n,o)&&!(Pe(o,n).length>0||(pe(),fe(e,"❓"),fe(t,"😨"),F=!1,0))}();a||!c&&!d||(i=!0,d&&(l=!0)),!i&&dt()>=100&&(fe(P,"🥵"),fe(R,"🥵"),l=!0),i||ft(W&&(t||n)),s&&E?(Z=!0,yt.style.display="block"):(Z=!1,yt.style.display="none"),l&&Mt()}function ut(e=$){let t="",n=8,o=0;const r=()=>{t=t.replace(/\*+/g,o),o=0};for(;n>=1;){for(let i="a";i<="h";a=i,i=String.fromCharCode(a.charCodeAt(0)+1)){const a=i+n,s=e.find((e=>e.squareId===a));if(!s)throw new Error(`[CHESS_ERROR] Unable to generate FEN due to missing squareId: ${a}`);const{color:l,pieceType:c}=s;if(c){let e="knight"===c?"n":c.charAt(0).toLowerCase();r(),t+="white"===l?e.toUpperCase():e}else t+="*",o++}r(),n>1&&(t+="/"),n--}var a;t+=M?" w ":" b ";let i="";at("white")||it("white","h1")||(i+="K"),at("white")||it("white","a1")||(i+="Q"),at("black")||it("black","h8")||(i+="k"),at("black")||it("black","a8")||(i+="q"),i||(i="-"),t+=i+" ",t+=(G||"-")+" ";const s=dt();t+=s+" ";const l=Math.floor(U.length/2)+1;return t+=l,t}function dt(){let e=0;for(let t=0;t<U.length;t++)e++,(U[t].hasCapture||"pawn"===U[t].pieceType||U[t].promotion)&&(e=0);return e}function ht(e){const t=document.querySelector(".eval.vertical");if(se=!se,void 0!==e&&(se=e),se?t?.classList.add("flip"):t?.classList.remove("flip"),ce(),he(),ue(),U.length){const{from:e,to:t}=U[U.length-1];Le(e,t)}if(pe(),Te(),Ce(),H=null,K.length){K[K.length-1].includes("+")&&(M?(Je(P,J),et(P)):(Je(R,J),et(R)))}}function ft(e,t=D[D.length-1]){if(E)return;if(e&&(F=!1),t=t||I,e&&z.length){const{from:e,to:t}=U[U.length-1],{from:n,to:o}=z.splice(0,1)[0];if(n===e&&o===t){const e=z.splice(0,1)[0];if(e)return void setTimeout((()=>{ke(e.from,e.to,!0),F=!0}),500)}}const n=document.getElementById("thinking");e&&n&&(n.style.display="inline-block"),function(e,t){const n=new Worker("./js/engine.js"),o=/score cp (-?\d+)/,r=/score mate (-?\d+)/,a=/ pv (.+)$/,i=/time (\d+)/,s=e.split(" ")[1];X&&X.terminate(),X=n;let l=1e3*(parseInt(j)+1);n.onmessage=e=>{const c=e.data,u={success:!1,mate:null,evaluation:null,continuation:""};if(c.includes("info depth")&&c.includes(" pv ")){if(c.includes(`info depth ${Q}`)&&(n.terminate(),X=null),o.test(c)){const e=o.exec(c)[1];u.evaluation=parseInt(e)/100}if(r.test(c)&&(u.mate=r.exec(c)[1],u.evaluation=null),a.test(c)&&(u.continuation=a.exec(c)[1]),"b"===s&&(u.evaluation&&(u.evaluation*=-1),u.mate&&(u.mate*=-1)),(u.mate||u.evaluation||u.continuation)&&(u.success=!0,gt(u.evaluation,u.mate)),c.includes(`info depth ${Q}`)&&t(u),j>=0&&i.test(c)){const e=i.exec(c)[1],n=l;parseInt(e)>=n&&t(u)}}},n.postMessage("isready"),n.postMessage("setoption name uci_elo value 5000"),n.postMessage("ucinewgame"),n.postMessage("isready"),n.postMessage(`position fen ${e}`);let c=`go depth ${Q}`;j>-1&&(c+=` movetime ${l}`),n.postMessage(c)}(t,(t=>{pt(t,e)}))}function pt(e,t){if(!e.success)throw new Error("SF failed");if(gt(e.evaluation,e.mate),!t)return;var n;F=!0,thinking&&(thinking.style.display="none"),n=e.continuation,e.mate,z=n.split(" ").map((e=>({from:e.slice(0,2),to:e.slice(2,5)})));const o=z.splice(0,1);if(!o.length)throw new Error("[SF_ERROR] No more moves found");const{from:r,to:a}=o[0];ke(r,a,!0)}ce(),de(),he(),ue(),D.push(ut()),document.getElementById("btnAutoFlip").addEventListener("click",(e=>{ie=!ie,ie?e.target.classList.add("glow"):e.target.classList.remove("glow")})),document.getElementById("btnReset").addEventListener("click",(e=>{E||(document.querySelectorAll(".piece").forEach((e=>e.remove())),document.querySelectorAll(".pgn-row").forEach((e=>e.remove())),de(),M=!0,x=I.split(" "),B=x[0],he(),D.push(ut()),Se(),Te(),Ce(),pe(),W=!1,document.getElementById("thinking").style.display="none",document.getElementById("btnVsBot")?.classList.remove("glow"),X&&(X.terminate(),X=null),ft(),document.getElementById("opening-name").textContent="",se&&ie&&ht(!1))})),document.getElementById("btnFlip").addEventListener("click",(()=>{ht()})),document.getElementById("btnVsBot").addEventListener("click",(e=>{E||(W=!W,F&&(W?(e.target.classList.add("glow"),V=M?"white":"black",F=!1,ft(!0),H&&(H=null,Te(),Ce())):e.target.classList.remove("glow")))})),document.getElementById("btnUndo").addEventListener("click",(e=>{if(E||!U.length)return;let t=U.length,n=D.length,o=Y.length,r=K.length;const a=U[t-1],{from:i,to:s,promotion:l}=a;if("pending"===l)return void u("illegal");F=!0,H&&(Te(),Ce(),H=null),W&&(X&&X.terminate(),document.getElementById("thinking").style.display="none"),Se(),pe(),n--,D.splice(n,1);const c=D[n-1];x=c.split(" "),B=x[0],G=x[3],M=!x[1]||"w"===x[1],$=[],he(),Ae(s,i),t--,U.splice(t,1);const d=r;r--,K.splice(r,1);const h=Math.floor(r/2)+1,f=document.querySelector(`.pgn-row:nth-child(${h})`);if(d%2==0?f.querySelector(".pgn-col:nth-child(3)").textContent="":f.remove(),K[r-1]?.includes("+")&&et(M?P:R),o--,Y.splice(o,1),Et(),ft(),U.length){const e=U[t-1];Le(e.to,e.from)}}));const mt=document.getElementById("btnRematch");function gt(e,t){null===e&&null!==t&&(e=t>0?Q:-1*Q);let n=50-e/Q*100;n=Math.min(n,98),n=Math.max(n,2);const o=document.querySelector(".eval.vertical .bar"),r=document.querySelector(".eval.vertical .num"),a=document.querySelector(".eval.horizontal .bar"),i=document.querySelector(".eval.horizontal .num");if(o&&(o.style.height=n+"%"),a&&(a.style.width=n+"%"),r){let n=Math.abs(e).toFixed(1);null!==t&&(n=`M${Math.abs(t)}`),r.textContent=n,e>0?r.classList.add("w"):r.classList.remove("w")}if(i){let n=Math.abs(e).toFixed(1);null!==t&&(n=`M${Math.abs(t)}`),i.textContent=n,e>0?i.classList.add("w"):i.classList.remove("w")}}function _t(e,t,n){const o=document.querySelector(".pgn");if(o){let r=Math.floor(e/2)+1;"black"===n&&e%2==0&&(r=Math.max(r-1,1));let a=null,i=null,s=null,l=document.createElement("button");if(document.querySelectorAll(".pgn-col button.active").forEach((e=>{e.classList.remove("active")})),"white"===n){a=document.createElement("div"),i=document.createElement("div"),s=document.createElement("span"),s.textContent=r+".",a.append(s),a.append(i);const e=document.createElement("div");e.classList.add("pgn-col"),a.append(e)}else i=document.querySelector(`.pgn-row:nth-child(${r}) .pgn-col:last-child`);l.textContent=t,a&&(a.classList.add("pgn-row"),o.append(a)),i.classList.add("pgn-col"),l.classList.add("active"),i.append(l)}if(e===U.length){const e=document.querySelector(".pgn-container");e&&(e.scrollTop=e.scrollHeight)}}mt.addEventListener("click",(e=>{mt.style.display="none",E&&k&&("finished"!==k.status&&"closed"!==k.status||At(w,{type:"c.rematch.request"}))})),mt.style.display="none",document.getElementById("btnCopyFenPGN").addEventListener("click",(()=>{let e=function(e=K){let t=bt();for(let n=0;n<e.length;n++){const o=Math.floor(n/2)+1;n%2==0&&(t+=o+". "),t+=e[n]+" "}return t}();navigator.clipboard.writeText(e),alert("FEN/PGN copied to clipboard")}));const vt=document.getElementById("btnCopyFenPGNALL");vt.addEventListener("click",(()=>{let e="";E&&k.pgnArchive?.length&&(e=function(e){let t="";return e.forEach((e=>{const n=e.rawPgn,{round:o,white:r,black:a,result:i,termination:s}=e;let l=bt({round:o,white:r,black:a,result:i,termination:s});for(let e=0;e<n.length;e++){const t=Math.floor(e/2)+1;e%2==0&&(l+=t+". "),l+=n[e]+" "}t+=l+"\n\n"})),t}(k.pgnArchive),navigator.clipboard.writeText(e),alert("FEN/PGN copied to clipboard"))})),vt.style.display="none";const yt=document.getElementById("btnDraw");yt.addEventListener("click",(()=>{E&&"ongoing"===k?.status&&Z&&confirm("Are you sure want to offer draw?")&&function(){const e=St();e&&[k.black.rid,k.white.rid].includes(e)&&At(w,{type:"c.draw.offer",data:St()})}()})),yt.style.display="none";const wt=document.getElementById("btnResign");function bt(e){const t=e?.event??"?",n=e?.site??window.location.hostname,o=e?.date??function(){const e=new Date(Date.now());return`${e.getFullYear()}.${(e.getMonth()+1).toString().padStart(2,"0")}.${e.getDate().toString().padStart(2,"0")}`}(),r=e?.round??"?",a=e?.white??"?",i=e?.black??"?",s=e?.result??"?",l=e?.fen??I,c=e?.termination;let u=`[Event "${t}"]\n`;return u+=`[Site "${n}"]\n`,u+=`[Date "${o}"]\n`,u+=`[Round "${r}"]\n`,u+=`[White "${a}"]\n`,u+=`[Black "${i}"]\n`,u+=`[Result "${s}"]\n`,u+=`[FEN "${l}"]\n`,c&&(u+=`[Termination "${c}"]\n`),u+"\n"}function Et(){let e=!1;const t=U.map((t=>{let n=t.from+t.to;return t.promotion&&("pending"!==t.promotion?n+=t.promotion:e=!0),n})).join(",");if(e)return;const n=document.getElementById("opening-name");n&&fetch(`https://explorer.lichess.ovh/masters?play=${t}`).then((e=>e.json())).then((e=>{const t=e?.opening?.name;t?n.innerHTML=t.replace(": ",":<br />"):n.textContent=""}))}function kt(){At(w,{data:St()??"anything",type:"c.connection.ping"})}function At(e,t){e.send(JSON.stringify(t))}function St(){return localStorage.getItem("rid")}function Ct(){At(w,{type:"c.rid.register"})}function Tt(e){const{boardState:t,moveState:n,fenState:o,rawPgn:r,white:a,black:i,status:s,scores:l,pgnArchive:c,time:u}=e;if(k=e,I=o[0],$=t,U=n,D=o,K=r,x=o[o.length-1].split(" "),B=x[0],M=!x[1]||"w"===x[1],he(),Et(),document.querySelectorAll(".pgn-row").forEach((e=>e.remove())),document.querySelectorAll(".pgn-col").forEach((e=>e.remove())),document.querySelectorAll("#btnReset").forEach((e=>e.remove())),document.querySelectorAll("#btnAutoFlip").forEach((e=>e.remove())),document.querySelectorAll("#btnFlip").forEach((e=>e.remove())),document.querySelectorAll("#btnUndo").forEach((e=>e.remove())),document.querySelectorAll(".eval").forEach((e=>e.remove())),document.querySelector("aside").style.marginTop="1.5rem",vt.style.display="inline-block",n.length>=C&&(wt.style.display="inline-block"),A=a?.name||null,S=i?.name||null,G=x[3],St()===i?.rid?ht(!0):ht(!1),K.forEach(((e,t)=>{const o=n[t].color;_t(t,e,o),t+1===n.length&&e.includes("+")&&("white"===o?et(R):"black"===o&&et(P))})),A&&S){const e=document.querySelector(".score .bottom span.name");e&&(e.textContent=se?S:A);const t=document.querySelector(".score .top span.name");t&&(t.textContent=se?A:S)}Bt(l),"waiting"!==s&&function(){const e=document.querySelector(".qr-container");if(!e)return;e.style.display="none"}(),"ongoing"===s||("finished"===s?(mt.style.display="block",wt.style.display="none",F=!1,Pt(c[0])):"closed"===s&&(mt.style.display="none")),u?It(e.time):function(){if(!E)return;const e=document.getElementById("app"),t=document.createElement("div");e.append(t),t.classList.add("form-time-container");[{logo:"🚀",name:"bullet",values:["1+0","1+2","2+1"]},{logo:"⚡",name:"blitz",values:["3+0","3+2","5+0"]},{logo:"⏲️",name:"rapid",values:["10+0","15+10","30+0"]}].forEach((({logo:e,name:n,values:o})=>{const r=document.createElement("div");t.append(r),r.classList.add(n);const a=document.createElement("span");a.textContent=e,r.append(a),o.forEach((e=>{const n=document.createElement("button"),[o,a]=e.split("+");r.append(n);let i=o;+a&&(i+="+"+a),n.textContent=i,n.addEventListener("click",(()=>{At(w,{type:"c.time.set",data:e}),t.remove()}))}))}))}()}function Lt(e,t){At(w,{type:"c.play.move",data:{from:e,to:t,moveState:U[U.length-1]}})}function It(e){k.time=e;const t=document.querySelector(".form-time-container");t&&t.remove();let[n]=e.split("+");if(n=n.padStart(2,"0"),Rt(),["finished","closed"].includes(k.status))return;const o=document.querySelector(".score .bottom span.time"),r=document.querySelector(".score .top span.time");o&&(o.textContent=`${n}:00`,o.classList.add("active"),o.classList.remove("rush")),r&&(r.textContent=`${n}:00`,r.classList.add("active"),r.classList.remove("rush")),Rt(),"waiting"===k.status&&function(){const e=document.querySelector(".qr-container");if(!e)return;e.style.display="flex";const t=document.getElementById("qr");if(!t)return void(e.style.display="none");new QRCode(t,window.location.href)}()}function xt(){const e=St();if(!E||!k||!e)return!0;return(M?k.white?.rid:k.black?.rid)===e}function Bt(e){const t=document.querySelector(".score .bottom span:first-child"),n=e=>e.replace(/\b(\d+)\.(\d+)\b/g,((e,t,n)=>n?"0"===t?"½":`${t} ½`:e));t&&(t.textContent=se?e[1]:e[0],t.textContent=n(t.textContent),se?t.parentElement.classList.add("flip"):t.parentElement.classList.remove("flip"));const o=document.querySelector(".score .top span:first-child");o&&(o.textContent=se?e[0]:e[1],o.textContent=n(o.textContent),se?o.parentElement.classList.add("flip"):o.parentElement.classList.remove("flip")),"finished"===k.status&&document.querySelectorAll(".time").forEach((e=>e.classList.add("active")))}function Mt(){At(w,{type:"c.draw.accepted",data:!0}),F=!1}function Pt(e){if(!/resign/i.test(e.termination))return;let t="";t=e.termination.split(" ")[0]===e.black?"white":"black";fe("white"===t?P:R,"🚩")}function Rt(){if(!(k&&k.time&&k.moveState.length&&k.timeWhite&&k.timeBlack))return;L||async function(){if(!("wakeLock"in navigator))return void console.warn("Lock not supported");try{L=await navigator.wakeLock.request("screen"),L.addEventListener("release",(()=>{}))}catch(e){}}();const{timeWhite:e,timeBlack:t}=k;clearInterval(T);const n=e=>{e=Math.max(e,0);const t=Math.floor(e/6e4),n=Math.floor(e%6e4/1e3);let o=0;e<=1e4&&(o=Math.floor(e%1e3/100));const r=e=>e.toString().padStart(2,"0"),a=e<=1e4?"."+o:"";return`${r(t)}:${r(n)}${a}`},o=e=>`.score .${e} span.time`,r=(e,t)=>{t<=1e4?e.classList.add("rush"):e.classList.remove("rush")};if(["bottom","top"].forEach((a=>{const i=document.querySelector(o(a));let s=0;s="bottom"===a?se?t.remaining:e.remaining:se?e.remaining:t.remaining,i.textContent=n(s),r(i,s)})),"ongoing"!==k.status)return;const a=M?"white":"black";let i=null;i="white"===a?k.timeWhite:k.timeBlack;let s=((e,t)=>{if(!t)return e;return e-=Date.now()-t})(i.remaining,i.start);s<=0&&qt(a);let l=1e3;const c=()=>{if(s-=l,"ongoing"===k.status&&s>0&&(s>=1e4?l=1e3:s<1e4&&90!==l&&(l=90,clearInterval(T),T=null),T||(T=setInterval(c,l))),s<=0)return void qt(a);const e=n(s);let t="white"===a?"bottom":"top";const i=St()===k.white.rid&&"white"===a,u=St()===k.white.rid&&"white"!==a,d=St()===k.black.rid&&"black"===a,h=St()===k.black.rid&&"black"!==a;i||d?t="bottom":(u||h)&&(t="top");const f=document.querySelector(o(t));document.querySelectorAll(".time").forEach((e=>e.classList.remove("active"))),f&&(f.textContent=e,f.classList.add("active"),r(f,s))};T=setInterval(c,l)}function qt(e){k.status="finished",F=!1,clearInterval(T),At(w,{type:"c.time.out",data:e})}wt.addEventListener("click",(()=>{E&&"ongoing"===k?.status&&(k.moveState.length<C||confirm("Are you sure you want to resign?")&&(k.status="finished",wt.style.display="none",At(w,{type:"c.resign"})))})),wt.style.display="none"})(),window.addEventListener("contextmenu",(e=>{e.preventDefault()}));let lastTouchEnd=0;async function checkForLatestVersion(){let e=null;try{e=await fetch("https://api.github.com/repos/nmrugg/stockfish.js/contents/src/stockfish-17-asm.js",{method:"GET",headers:{Accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28"}})}catch(e){console.error(e)}if(e&&404===e.status){const e="⚠️ A new version of engine is available!";console.warn(e),alert(e)}}var QRCode;function renderSettings(e,t,n){if(!e||!t||!n)throw new Error("[SETTINGS_ERROR] Invalid argument");const o=document.getElementById("settings");if(!o)return;("ontouchstart"in window||navigator.maxTouchPoints>0)&&(window.location.pathname.includes("/room")||o.classList.add("t-25px")),o.innerHTML='\n    <div class="settings-actions">\n        <button id="btnSettings">\n            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>\n        </button>\n    </div>\n  ';let r=null,a=null,i=null;function s(e){const t=document.createElement("div");return e&&t.classList.add(e),t}function l(){const e=s("settings-options"),t=document.createElement("ul"),o={Boards:u(),Pieces:c()};return Object.keys(o).forEach((e=>{const n=document.createElement("li");t.append(n),n.textContent=e,n.classList.add("expandable"),n.onclick=()=>{a.replaceChildren(o[e]),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><path d="m15 18-6-6 6-6"/></svg>'+e}})),e.append(t,function(){const e=s("settings-bot"),t=s("title"),o=document.createElement("span"),r=document.createElement("span"),a=document.createElement("input");o.textContent="Bot Thinking Time",r.textContent="2s";let i=localStorage.getItem("search-time");a.type="range",a.min="0",a.max="10",a.value=+i<=-1?"10":i;const l=()=>{parseInt(a.value)<10?r.textContent=parseInt(a.value)+1+"s":r.textContent="max"};return l(),a.oninput=()=>{l()},a.onchange=()=>{let e=a.value<10?a.value:-1;n(e),localStorage.setItem("search-time",e)},t.append(o,r),e.append(t,a),e}()),e}function c(){const t=s("settings-view--pieces"),n=s("settings-options"),o=document.createElement("ul"),r=["cburnett","icy_sea","ocean","glass","game_room","neo","3d_staunton"],a=["wk","bq","wr","bb","wn","bp"],i="https://raw.githubusercontent.com/lightzane/chess.com-boards-and-pieces/refs/heads/main/pieces",l=/\/pieces\/(.*)\/(.*)\./i,c=/\/pieces\/.*\/(b|w)(k|q|r|b|n|p)\.(svg|png)$/i,u=localStorage.getItem("pieces");return r.includes(u)||localStorage.removeItem("pieces"),r.forEach((t=>{const n=document.createElement("li");u===t&&(n.classList.add("selected"),setTimeout((()=>{n.scrollIntoView({behavior:"smooth"})}),1e3)),o.append(n);let r="png";"cburnett"===t&&(r="svg"),a.forEach((e=>{const o=document.createElement("img");o.src=((e,t)=>`${i}/${e}/${t}.`)(t,e)+r,n.append(o)})),n.onclick=()=>{Object.keys(e).forEach((n=>{const o=e[n];if(!c.test(o))return;const[a,s,l]=c.exec(o),u=`${i}/${t}/${s}${l}.${r}`;e[n]=u})),document.querySelectorAll(".board .square .piece img").forEach((e=>{if(!l.test(e.src))return;const[n,o,a]=l.exec(e.src);e.src=`${i}/${t}/${a}.${r}`})),o.querySelectorAll("li").forEach((e=>e.classList.remove("selected"))),n.classList.add("selected"),localStorage.setItem("pieces",t)}})),t.append(n),n.append(o),t}function u(){const e=s("settings-view--boards"),n=s("settings-options"),o=document.createElement("ul"),r=["custompink","icy_sea","customwood","custombrown","customblue","dark_wood","customgreen"],a=/^\/([a-z]*)\/*/i;let i=window.location.pathname;if(a.test(i)){const e=["room","cheese"],t=a.exec(i)[1];i=e.includes(t)?"/"+t:"..","room"===t&&(i="")}const l=`${i}/images/board`,c=localStorage.getItem("board");return r.includes(c)||localStorage.removeItem("board"),r.forEach((e=>{const n=document.createElement("li");c===e&&(n.classList.add("selected"),setTimeout((()=>{n.scrollIntoView({behavior:"smooth"})}),1e3)),o.append(n);const r=document.createElement("img");r.src=`${l}/thumbnail-${e.replace("custom","")}.png`,n.append(r),n.onclick=()=>{t(e),o.querySelectorAll("li").forEach((e=>e.classList.remove("selected"))),n.classList.add("selected"),localStorage.setItem("board",e)}})),e.append(n),n.append(o),e}document.getElementById("btnSettings").addEventListener("click",(()=>{r=function(){const e=s("settings-popup");return e.append(function(){const e=s("settings-content"),t=s("settings-header"),n=s("settings-body"),o=s("settings-title"),c=document.createElement("a");return e.onclick=e=>{e.stopPropagation()},o.textContent="Settings",c.classList.add("close"),c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-x"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>',c.href="#",c.onclick=e=>{e.preventDefault(),r.remove(),r=null},a=l(),i=o,i.onclick=()=>{i.innerHTML="Settings",a.replaceChildren(l())},e.append(t),e.append(n),t.append(o),t.append(c),n.append(a),e}()),e}(),r.onclick=()=>{r.remove(),r=null},document.body.append(r)}))}window.addEventListener("touchend",(e=>{const t=(new Date).getTime();t-lastTouchEnd<=888&&e.preventDefault(),lastTouchEnd=t})),Math.random()<.3&&checkForLatestVersion(),function(){function e(e){this.mode=s.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=[],n=0,o=this.data.length;o>n;n++){var r=this.data.charCodeAt(n);r>65536?(t[0]=240|(1835008&r)>>>18,t[1]=128|(258048&r)>>>12,t[2]=128|(4032&r)>>>6,t[3]=128|63&r):r>2048?(t[0]=224|(61440&r)>>>12,t[1]=128|(4032&r)>>>6,t[2]=128|63&r):r>128?(t[0]=192|(1984&r)>>>6,t[1]=128|63&r):t[0]=r,this.parsedData=this.parsedData.concat(t)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function n(e,t){if(null==e.length)throw new Error(e.length+"/"+t);for(var n=0;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(var o=0;o<e.length-n;o++)this.num[o]=e[o+n]}function o(e,t){this.totalCount=e,this.dataCount=t}function r(){this.buffer=[],this.length=0}function a(){var e=!1,t=navigator.userAgent;return/android/i.test(t)&&(e=!0,aMat=t.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(e=parseFloat(aMat[1]))),e}function i(e,t){for(var n=1,o=function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}(e),r=0,a=f.length;a>=r;r++){var i=0;switch(t){case l.L:i=f[r][0];break;case l.M:i=f[r][1];break;case l.Q:i=f[r][2];break;case l.H:i=f[r][3]}if(i>=o)break;n++}if(n>f.length)throw new Error("Too long data");return n}e.prototype={getLength:function(){return this.parsedData.length},write:function(e){for(var t=0,n=this.parsedData.length;n>t;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var n=new e(t);this.dataList.push(n),this.dataCache=null},isDark:function(e,t){if(0>e||this.moduleCount<=e||0>t||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var o=0;o<this.moduleCount;o++){this.modules[o]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[o][r]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,n),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(e,t){for(var n=-1;7>=n;n++)if(!(-1>=e+n||this.moduleCount<=e+n))for(var o=-1;7>=o;o++)-1>=t+o||this.moduleCount<=t+o||(this.modules[e+n][t+o]=n>=0&&6>=n&&(0==o||6==o)||o>=0&&6>=o&&(0==n||6==n)||n>=2&&4>=n&&o>=2&&4>=o)},getBestMaskPattern:function(){for(var e=0,t=0,n=0;8>n;n++){this.makeImpl(!0,n);var o=u.getLostPoint(this);(0==n||e>o)&&(e=o,t=n)}return t},createMovieClip:function(e,t,n){var o=e.createEmptyMovieClip(t,n);this.make();for(var r=0;r<this.modules.length;r++)for(var a=1*r,i=0;i<this.modules[r].length;i++){var s=1*i;this.modules[r][i]&&(o.beginFill(0,100),o.moveTo(s,a),o.lineTo(s+1,a),o.lineTo(s+1,a+1),o.lineTo(s,a+1),o.endFill())}return o},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=0==e%2);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=0==t%2)},setupPositionAdjustPattern:function(){for(var e=u.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var o=e[t],r=e[n];if(null==this.modules[o][r])for(var a=-2;2>=a;a++)for(var i=-2;2>=i;i++)this.modules[o+a][r+i]=-2==a||2==a||-2==i||2==i||0==a&&0==i}},setupTypeNumber:function(e){for(var t=u.getBCHTypeNumber(this.typeNumber),n=0;18>n;n++){var o=!e&&1==(1&t>>n);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=o}for(n=0;18>n;n++){o=!e&&1==(1&t>>n);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=o}},setupTypeInfo:function(e,t){for(var n=this.errorCorrectLevel<<3|t,o=u.getBCHTypeInfo(n),r=0;15>r;r++){var a=!e&&1==(1&o>>r);6>r?this.modules[r][8]=a:8>r?this.modules[r+1][8]=a:this.modules[this.moduleCount-15+r][8]=a}for(r=0;15>r;r++){a=!e&&1==(1&o>>r);8>r?this.modules[8][this.moduleCount-r-1]=a:9>r?this.modules[8][15-r-1+1]=a:this.modules[8][15-r-1]=a}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var n=-1,o=this.moduleCount-1,r=7,a=0,i=this.moduleCount-1;i>0;i-=2)for(6==i&&i--;;){for(var s=0;2>s;s++)if(null==this.modules[o][i-s]){var l=!1;a<e.length&&(l=1==(1&e[a]>>>r)),u.getMask(t,o,i-s)&&(l=!l),this.modules[o][i-s]=l,-1==--r&&(a++,r=7)}if(0>(o+=n)||this.moduleCount<=o){o-=n,n=-n;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,n,a){for(var i=o.getRSBlocks(e,n),s=new r,l=0;l<a.length;l++){var c=a[l];s.put(c.mode,4),s.put(c.getLength(),u.getLengthInBits(c.mode,e)),c.write(s)}var d=0;for(l=0;l<i.length;l++)d+=i[l].dataCount;if(s.getLengthInBits()>8*d)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*d+")");for(s.getLengthInBits()+4<=8*d&&s.put(0,4);0!=s.getLengthInBits()%8;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*d)&&(s.put(t.PAD0,8),!(s.getLengthInBits()>=8*d));)s.put(t.PAD1,8);return t.createBytes(s,i)},t.createBytes=function(e,t){for(var o=0,r=0,a=0,i=new Array(t.length),s=new Array(t.length),l=0;l<t.length;l++){var c=t[l].dataCount,d=t[l].totalCount-c;r=Math.max(r,c),a=Math.max(a,d),i[l]=new Array(c);for(var h=0;h<i[l].length;h++)i[l][h]=255&e.buffer[h+o];o+=c;var f=u.getErrorCorrectPolynomial(d),p=new n(i[l],f.getLength()-1).mod(f);s[l]=new Array(f.getLength()-1);for(h=0;h<s[l].length;h++){var m=h+p.getLength()-s[l].length;s[l][h]=m>=0?p.get(m):0}}var g=0;for(h=0;h<t.length;h++)g+=t[h].totalCount;var _=new Array(g),v=0;for(h=0;r>h;h++)for(l=0;l<t.length;l++)h<i[l].length&&(_[v++]=i[l][h]);for(h=0;a>h;h++)for(l=0;l<t.length;l++)h<s[l].length&&(_[v++]=s[l][h]);return _};for(var s={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},l={L:1,M:0,Q:3,H:2},c={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;u.getBCHDigit(t)-u.getBCHDigit(u.G15)>=0;)t^=u.G15<<u.getBCHDigit(t)-u.getBCHDigit(u.G15);return(e<<10|t)^u.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;u.getBCHDigit(t)-u.getBCHDigit(u.G18)>=0;)t^=u.G18<<u.getBCHDigit(t)-u.getBCHDigit(u.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return u.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case c.PATTERN000:return 0==(t+n)%2;case c.PATTERN001:return 0==t%2;case c.PATTERN010:return 0==n%3;case c.PATTERN011:return 0==(t+n)%3;case c.PATTERN100:return 0==(Math.floor(t/2)+Math.floor(n/3))%2;case c.PATTERN101:return 0==t*n%2+t*n%3;case c.PATTERN110:return 0==(t*n%2+t*n%3)%2;case c.PATTERN111:return 0==(t*n%3+(t+n)%2)%2;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new n([1],0),o=0;e>o;o++)t=t.multiply(new n([1,d.gexp(o)],0));return t},getLengthInBits:function(e,t){if(t>=1&&10>t)switch(e){case s.MODE_NUMBER:return 10;case s.MODE_ALPHA_NUM:return 9;case s.MODE_8BIT_BYTE:case s.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>t)switch(e){case s.MODE_NUMBER:return 12;case s.MODE_ALPHA_NUM:return 11;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>t))throw new Error("type:"+t);switch(e){case s.MODE_NUMBER:return 14;case s.MODE_ALPHA_NUM:return 13;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,o=0;t>o;o++)for(var r=0;t>r;r++){for(var a=0,i=e.isDark(o,r),s=-1;1>=s;s++)if(!(0>o+s||o+s>=t))for(var l=-1;1>=l;l++)0>r+l||r+l>=t||(0!=s||0!=l)&&i==e.isDark(o+s,r+l)&&a++;a>5&&(n+=3+a-5)}for(o=0;t-1>o;o++)for(r=0;t-1>r;r++){var c=0;e.isDark(o,r)&&c++,e.isDark(o+1,r)&&c++,e.isDark(o,r+1)&&c++,e.isDark(o+1,r+1)&&c++,(0==c||4==c)&&(n+=3)}for(o=0;t>o;o++)for(r=0;t-6>r;r++)e.isDark(o,r)&&!e.isDark(o,r+1)&&e.isDark(o,r+2)&&e.isDark(o,r+3)&&e.isDark(o,r+4)&&!e.isDark(o,r+5)&&e.isDark(o,r+6)&&(n+=40);for(r=0;t>r;r++)for(o=0;t-6>o;o++)e.isDark(o,r)&&!e.isDark(o+1,r)&&e.isDark(o+2,r)&&e.isDark(o+3,r)&&e.isDark(o+4,r)&&!e.isDark(o+5,r)&&e.isDark(o+6,r)&&(n+=40);var u=0;for(r=0;t>r;r++)for(o=0;t>o;o++)e.isDark(o,r)&&u++;return n+10*(Math.abs(100*u/t/t-50)/5)}},d={glog:function(e){if(1>e)throw new Error("glog("+e+")");return d.LOG_TABLE[e]},gexp:function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return d.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},h=0;8>h;h++)d.EXP_TABLE[h]=1<<h;for(h=8;256>h;h++)d.EXP_TABLE[h]=d.EXP_TABLE[h-4]^d.EXP_TABLE[h-5]^d.EXP_TABLE[h-6]^d.EXP_TABLE[h-8];for(h=0;255>h;h++)d.LOG_TABLE[d.EXP_TABLE[h]]=h;n.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),o=0;o<this.getLength();o++)for(var r=0;r<e.getLength();r++)t[o+r]^=d.gexp(d.glog(this.get(o))+d.glog(e.get(r)));return new n(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=d.glog(this.get(0))-d.glog(e.get(0)),o=new Array(this.getLength()),r=0;r<this.getLength();r++)o[r]=this.get(r);for(r=0;r<e.getLength();r++)o[r]^=d.gexp(d.glog(e.get(r))+t);return new n(o,0).mod(e)}},o.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],o.getRSBlocks=function(e,t){var n=o.getRsBlockTable(e,t);if(null==n)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var r=n.length/3,a=[],i=0;r>i;i++)for(var s=n[3*i+0],l=n[3*i+1],c=n[3*i+2],u=0;s>u;u++)a.push(new o(l,c));return a},o.getRsBlockTable=function(e,t){switch(t){case l.L:return o.RS_BLOCK_TABLE[4*(e-1)+0];case l.M:return o.RS_BLOCK_TABLE[4*(e-1)+1];case l.Q:return o.RS_BLOCK_TABLE[4*(e-1)+2];case l.H:return o.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},r.prototype={get:function(e){var t=Math.floor(e/8);return 1==(1&this.buffer[t]>>>7-e%8)},put:function(e,t){for(var n=0;t>n;n++)this.putBit(1==(1&e>>>t-n-1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var f=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],p=function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){function t(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);for(var o in t)t.hasOwnProperty(o)&&n.setAttribute(o,t[o]);return n}var n=this._htOption,o=this._el,r=e.getModuleCount();Math.floor(n.width/r),Math.floor(n.height/r),this.clear();var a=t("svg",{viewBox:"0 0 "+String(r)+" "+String(r),width:"100%",height:"100%",fill:n.colorLight});a.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),o.appendChild(a),a.appendChild(t("rect",{fill:n.colorDark,width:"1",height:"1",id:"template"}));for(var i=0;r>i;i++)for(var s=0;r>s;s++)if(e.isDark(i,s)){var l=t("use",{x:String(i),y:String(s)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),a.appendChild(l)}},e.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},e}(),m="svg"===document.documentElement.tagName.toLowerCase()?p:"undefined"!=typeof CanvasRenderingContext2D?function(){function e(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function t(e,t){var n=this;if(n._fFail=t,n._fSuccess=e,null===n._bSupportDataURI){var o=document.createElement("img"),r=function(){n._bSupportDataURI=!1,n._fFail&&_fFail.call(n)};return o.onabort=r,o.onerror=r,o.onload=function(){n._bSupportDataURI=!0,n._fSuccess&&n._fSuccess.call(n)},void(o.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===n._bSupportDataURI&&n._fSuccess?n._fSuccess.call(n):!1===n._bSupportDataURI&&n._fFail&&n._fFail.call(n)}if(this._android&&this._android<=2.1){var n=1/window.devicePixelRatio,o=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,t,r,a,i,s,l,c){if("nodeName"in e&&/img/i.test(e.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*n;else void 0===c&&(arguments[1]*=n,arguments[2]*=n,arguments[3]*=n,arguments[4]*=n);o.apply(this,arguments)}}var r=function(e,t){this._bIsPainted=!1,this._android=a(),this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return r.prototype.draw=function(e){var t=this._elImage,n=this._oContext,o=this._htOption,r=e.getModuleCount(),a=o.width/r,i=o.height/r,s=Math.round(a),l=Math.round(i);t.style.display="none",this.clear();for(var c=0;r>c;c++)for(var u=0;r>u;u++){var d=e.isDark(c,u),h=u*a,f=c*i;n.strokeStyle=d?o.colorDark:o.colorLight,n.lineWidth=1,n.fillStyle=d?o.colorDark:o.colorLight,n.fillRect(h,f,a,i),n.strokeRect(Math.floor(h)+.5,Math.floor(f)+.5,s,l),n.strokeRect(Math.ceil(h)-.5,Math.ceil(f)-.5,s,l)}this._bIsPainted=!0},r.prototype.makeImage=function(){this._bIsPainted&&t.call(this,e)},r.prototype.isPainted=function(){return this._bIsPainted},r.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},r.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},r}():function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){for(var t=this._htOption,n=this._el,o=e.getModuleCount(),r=Math.floor(t.width/o),a=Math.floor(t.height/o),i=['<table style="border:0;border-collapse:collapse;">'],s=0;o>s;s++){i.push("<tr>");for(var l=0;o>l;l++)i.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+r+"px;height:"+a+"px;background-color:"+(e.isDark(s,l)?t.colorDark:t.colorLight)+';"></td>');i.push("</tr>")}i.push("</table>"),n.innerHTML=i.join("");var c=n.childNodes[0],u=(t.width-c.offsetWidth)/2,d=(t.height-c.offsetHeight)/2;u>0&&d>0&&(c.style.margin=d+"px "+u+"px")},e.prototype.clear=function(){this._el.innerHTML=""},e}();QRCode=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:l.H},"string"==typeof t&&(t={text:t}),t)for(var n in t)this._htOption[n]=t[n];"string"==typeof e&&(e=document.getElementById(e)),this._android=a(),this._el=e,this._oQRCode=null,this._oDrawing=new m(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(e){this._oQRCode=new t(i(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=l}();